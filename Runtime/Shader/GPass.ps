#include "GlobalInput.sh"
#include "GlobalPSConstant.sh"


//--------------------------------------------------------------------------------------
// Pixel Shader
//--------------------------------------------------------------------------------------
#ifdef _BUMP
float4 PS( PsIn_Bump In) : SV_Target
#else
float4 PS( PsIn In) : SV_Target
#endif
{
	float3 diffuse = txDiffuse.Sample( samLinear, In.Tex).rgb;

#ifdef _BUMP
    float3 bump = 1.5f * ( txNormal.Sample( samLinear, In.Tex).rgb - float3(0.5,0.5,0.5) );
	In.ViewNormal = In.ViewNormal + bump.x*In.ViewTangent + bump.y*In.ViewBinormal;
    In.ViewNormal = normalize(In.ViewNormal);
#endif

	float NL = saturate( dot(In.ViewNormal, g_SunDirection) ); 

	float3 finalColor = diffuse * NL + g_ambientColor; 
	return float4(finalColor, 1);
}
